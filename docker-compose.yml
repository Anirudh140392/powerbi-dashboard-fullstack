services:
  # Backend API Service
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: backend
    ports:
      - "5000:5000"
    environment:
      - NODE_ENV=production
      - PORT=5000
      - REDIS_HOST=host.docker.internal
      - REDIS_PORT=6379
      - REDIS_PASSWORD=
      - REDIS_DB=0
      - REDIS_ENABLED=false
      - REDIS_DEFAULT_TTL=2000
      - CLICKHOUSE_URL=http://13.200.55.131:8123
      - CLICKHOUSE_USER=readonly_user
      - CLICKHOUSE_PASSWORD=Readonly@123
      - CLICKHOUSE_DB=gcpl
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 13G
          cpus: '3'
        reservations:
          memory: 4G

  # Frontend UI Service
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: frontend
    ports:
      - "9400:9500"
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 1400M
          cpus: '1'
        reservations:
          memory: 512M
